   <section class="inscription">
        <img class="img-inscription" src="./assets/images/P1_soudeur.jpg" alt="une image d\'un soudeur.">

            <form class="form-inscription" action="/utilisateur/create" method="post">
            <h1 class="titre-inscr">CR√âATION <br>
                DE COMPTE</h1>

                <label>Nom</label>
                <input type="text" name="nom" required >
                
                <label>Pr√©nom</label>
                <input type="text" name="prenom" required >
                
                <label>Email</label>
                <input type="email" name="email" required >
                
                <label>T√©l√©phone</label>
                <input type="text" name="telephone" required >
                
                <label>Mot de passe</label>
                <input type="passeword" name="mot de passe" required >
                
                <button type="submit">CR√âER UN COMPTE</button>
            </form>
        </section> 
        ';
    } 


public function loginForm()
    {
        echo '<h1>Connexion</h1>
        <section class="connexion">
            <img class="img-connexion" src="./assets/images/P4_soudeurPosition.png" alt="un soudeur.">

            <form class="form-connexion" action="utilisateur/login" method="post">
                            
                <label>Email</label>
                <input type="email" name="email" required >
                
                <label>Mot de passe</label>
                <input type="passeword" name="mot de passe" required >
                
                <button type="submit">Se connecter</button>
            </form>
        </section>
    ';
    }
} 





<MENU>
    <?php if ($afficherLayout): ?>
    <?php include 'assets/templates/menu.php'; ?>
<?php endif; ?>

<header>

<div class="logo">
    <div class="rectangle-header"></div>
    <div class="diagonale-header"> </div>
    <a href="/accueil">
        <img src="assets/images/LOGO.svg" alt="Logo de l'entreprise">
</a>
 </div>



    <nav>
        <a href="/accueil">Accueil</a>
        <a href="/bureauEtude">Bureau d'√©tude</a>
        <a href="/domaineExpertise">Notre expertise</a>
        <a href="recrutement">Recrutement</a>
        <a href="/contact/utilisateur/create">Contact</a>
    </nav>

    

    <nav class="menu">
    <?php if (isset($_SESSION['utilisateur'])): ?>
        <?php if ($_SESSION['utilisateur']['role'] === 'administrateur'): ?>
            <!-- Menu administrateur -->
            <a href="/administrateur/dashboard">Dashboard</a>
            <a href="/administrateur/annonces">Annonces</a>
            <a href="/administrateur/candidatures">Candidatures</a>
            <a href="/utilisateur/create">Cr√©er un utilisateur</a>
            <a href="/utilisateur/manage">G√©rer les utilisateurs</a>
            <a href="/utilisateur/logout">D√©connexion</a>
        <?php elseif ($_SESSION['utilisateur']['role'] === 'candidat'): ?>
            <!-- Menu candidat -->
            <a href="/candidat/profil">Profil</a>
            <a href="/candidat/annonces">Voir les annonces</a>
            <a href="/candidat/candidatures">Mes candidatures</a>
            <a href="/utilisateur/logout">D√©connexion</a>
        <?php else: ?>
            <!-- Menu g√©n√©rique connect√© (autres r√¥les) -->
            <a href="/utilisateur/logout">D√©connexion</a>
        <?php endif; ?>
    <?php else: ?>
        <!-- Menu visiteur -->
        <a href="/utilisateur/login">Connexion</a>
        <a href="/utilisateur/create">Inscription</a>
    <?php endif; ?>
</nav>

</header>
<div class="separateur-header"></div>




</MENU>

    <!-- <nav class="menu">
    <?php if (isset($_SESSION['utilisateur'])): ?>
            <?php if ($_SESSION['utilisateur']['role'] === 'administrateur'): ?>
                
                <a href="/candidat/profil" class="<?= ($_SERVER['REQUEST_URI'] == '/candidat/profil') ? 'active' : '' ?>">Profil</a>

                
                <a href="/administrateur/dashboard">Dashboard</a>
                <a href="/administrateur/annonces">Annonces</a>
                <a href="/administrateur/candidatures">Candidatures</a>
                <a href="/utilisateur/create">Cr√©er un utilisateur</a>
                <a href="/utilisateur/manage">G√©rer les utilisateurs</a>
                <a href="/utilisateur/logout">D√©connexion</a>
                
            <?php elseif ($_SESSION['utilisateur']['role'] === 'candidat'): ?>
                <a href="/candidat/profil">Profil</a>
                <a href="/candidat/annonces">Voir les annonces</a>
                <a href="/candidat/candidatures">Mes candidatures</a>
                <a href="/utilisateur/logout">D√©connexion</a>
            <?php else: ?>
                <a href="/utilisateur/logout">D√©connexion</a>
            <?php endif; ?>
        <?php else: ?>
            <a href="/utilisateur/login">Connexion</a>
            <a href="/utilisateur/create">Inscription</a>
        <?php endif; ?>
    </nav> -->




    MENU V2 


    <header>
    <!-- üîê Menu connect√© dynamique -->
    <?php
    if (isset($_SESSION['utilisateur'])) {
        $role = $_SESSION['utilisateur']['role'];
        if ($role === 'administrateur' || $role === 'candidat') {
            echo '<nav class="menu">';
            if ($role === 'administrateur') {
                echo '<a href="/administrateur/profil">Profil admin</a>';
                echo '<a href="/administrateur/annonces">Annonces</a>';
                echo '<a href="/administrateur/create-annonce">Cr√©er une annonce</a>';
                echo '<a href="/utilisateur/edit-annonce">Modifier une annonce</a>';
                echo '<a href="/utilisateur/candidatures">G√©rer les utilisateurs</a>';
                echo '<a href="/utilisateur/candidature">G√©rer un utilisateur</a>';
                echo '<a href="/utilisateur/logout">D√©connexion</a>';
            } elseif ($role === 'candidat') {
                echo '<a href="/candidat/profil" class="' . ($_SERVER['REQUEST_URI'] == '/candidat/profil' ? 'active' : '') . '">Profil</a>';
                echo '<a href="/candidat/annonces">Voir les annonces</a>';
                echo '<a href="/candidat/candidatures">Mes candidatures</a>';
                echo '<a href="/utilisateur/logout">D√©connexion</a>';
            }
            echo '</nav>';
        }
    }


    //  üé® Logo entreprise
    <div class="logo">
        <div class="rectangle-header"></div>
        <div class="diagonale-header"></div>
        <a href="/accueil">
            <img src="assets/images/LOGO.svg" alt="Logo de l'entreprise">
        </a>
    </div>

    <!-- üåç Menu principal g√©n√©ral -->
    <nav class="nav-principal">
        <a href="/accueil">Accueil</a>
        <a href="/bureauEtude">Bureau d √©tude</a>
        <a href="/domaineExpertise">Notre expertise</a>
        <a href="/recrutement">Recrutement</a>
        <a href="/contact">Contact</a>
    </nav>
</header>

<!-- üìè Ligne de s√©paration visuelle -->
<div class="separateur-header"></div>





    <!-- üé® Logo entreprise -->
    <div class="logo">
        <div class="rectangle-header"></div>
        <div class="diagonale-header"></div>
        <a href="/accueil">
            <img src="assets/images/LOGO.svg" alt="Logo de l'entreprise">
        </a>
    </div>



    <!-- üåç Menu principal g√©n√©ral -->
    <nav class="nav-principal">
        <a href="/accueil">Accueil</a>
        <a href="/bureauEtude">Bureau d √©tude</a>
        <a href="/domaineExpertise">Notre expertise</a>
        <a href="/recrutement">Recrutement</a>
        <a href="/contact">Contact</a>
    </nav>

</header>

<!-- üìè Ligne de s√©paration visuelle -->
<div class="separateur-header"></div> 














<?php


declare(strict_types=1);
session_start();


require_once __DIR__ . '/vendor/autoload.php';

use App\Controller\{
    AdministrateurController,
    CandidatController,
    AnnonceController,
    CandidatureController,
    EntretienController,
    CalendrierController,
    UtilisateurController,
    NewsController
};

// Chargement des variables d‚Äôenvironnement
Dotenv\Dotenv::createImmutable(__DIR__)->load();

// üîç Routing parameters
$requestUri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);
$segments = array_values(array_filter(explode('/', $requestUri)));

$action = $_GET['action'] ?? ($segments[0] ?? '');
$step   = $_GET['step']   ?? ($segments[1] ?? '');
$id     = $_GET['id']     ?? ($segments[2] ?? '');


// üñºÔ∏è Layout control
$afficherMenuPublic   = in_array($action, ['accueil', 'bureauEtude', 'domaineExpertise', 'recrutement', 'contact']);
$afficherMenuConnecte = isset([
    'administrateur' => true,
    'candidat'       => true
][$action]);

$afficherFooter = $afficherMenuPublic;

// Templates head + menu
require_once('assets/templates/head.php');
if ($afficherMenuConnecte) require_once('assets/templates/menu-connecte.php');
if ($afficherMenuPublic)   require_once('assets/templates/menu-public.php');


// üéØ Routes
switch ($action) {
    case 'accueil':
    case 'bureauEtude':
    case 'domaineExpertise':
    case 'recrutement':
    case 'contact':
        include "Pages/{$action}.php";
        break;

    case 'administrateur':
        $ctrl = new AdministrateurController;
        match ($step) {
            'dashboard'       => $ctrl->dashboard($_SESSION['utilisateur']['id']),
            'profil'          => $ctrl->profil($_SESSION['utilisateur']['id']),
            'annonces'        => $ctrl->viewAnnonces(),
            'create-annonce'  => $ctrl->createAnnonce(),
            'edit-annonce'    => $ctrl->editAnnonce((int)$id),
            'archive-annonce' => $ctrl->archiveAnnonce((int)$id),
            'candidatures'    => $ctrl->listCandidatures(),
            'candidature'     => $ctrl->viewCandidature((int)$id),
            default           => $ctrl->dashboard($_SESSION['utilisateur']['id']),
        };
        break;

    case 'candidat':
        $ctrl = new CandidatController;
        match ($step) {
            'profil'          => $ctrl->profil(),
            'update'          => $ctrl->update(),
            'delete'          => $ctrl->delete(),
            'upload-cv'       => $ctrl->uploadCV(),
            'annonces'        => $ctrl->listAnnonces(),
            'annonce-view'    => $ctrl->viewAnnonce((int)$id),
            'postuler'        => $ctrl->postuler((int)$id),
            'candidatures'    => $ctrl->suiviCandidatures(),
            default           => $ctrl->profil(),
        };
        break;

        case 'annonce':
            $ctrl = new AnnonceController;
            match ($step) {
                'create' => $ctrl->createAnnonce(),
                'update' => $id ? $ctrl->updateAnnonce((int)$id) : print("‚ö†Ô∏è ID manquant"),
                'view'   => $id ? $ctrl->viewAnnonce((int)$id) : print("‚ö†Ô∏è ID manquant"),
                'delete' => $id ? $ctrl->deleteAnnonce((int)$id) : print("‚ö†Ô∏è ID manquant"),
                default  => $ctrl->listAnnonces(),
            };
            break;

    case 'candidature':
        $ctrl = new CandidatureController;
        match ($step) {
            'submit' => $ctrl->submitCandidature(),
            'view'   => $ctrl->viewCandidature((int)$id),
            'delete' => $ctrl->deleteCandidature((int)$id),
            'suivi'  => $ctrl->suivi(),
            default  => $ctrl->listCandidatures(),
        };
        break;

    case 'entretien':
        $ctrl = new EntretienController;
        match ($step) {
            'planifier' => $ctrl->planifierEntretien(),
            'rappel'    => $ctrl->envoyerRappel((int)$id),
            default     => $ctrl->listEntretiens(),
        };
        break;

    case 'utilisateur':
        $ctrl = new UtilisateurController;
        match ($step) {
            'create' => $ctrl->createUtilisateur(),
            'edit'   => $ctrl->editUtilisateur((int)$id),
            'login'  => $ctrl->loginUtilisateur(),
            'logout' => $ctrl->logoutUtilisateur(),
            'update' => $ctrl->updateUtilisateur(),
            'delete' => $ctrl->deleteUtilisateur((int)$id),
            default  => $ctrl->listUtilisateur(),
        };
        break;

    case 'calendrier':
        $ctrl = new CalendrierController;
        match ($step) {
            'semaine'      => $ctrl->vueSemaine(),
            'jour'         => $ctrl->vueJour($id),
            'rappel'       => $ctrl->rappelDuJour(),
            'rendez-vous'  => $ctrl->infoRendezVous($id),
            default        => $ctrl->vueSemaine(),
        };
        break;

    default:
        include "Pages/accueil.php";
        break;
}

// Footer si n√©cessaire
if ($afficherFooter) {
    require_once('assets/templates/footer.php');
}
